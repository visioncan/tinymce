var PREFIX_LIST,TEXT_MARKER_CLASS_NAME,TEXT_MARKER_OPTIONS,capitalizeString,clearCompositionTextMarkers,getPrefixedPropertyName,initCompositionMode,modInitialized,resetInputTranslate,setInputTranslate;modInitialized=!1,TEXT_MARKER_CLASS_NAME="CodeMirror-text-in-composition",TEXT_MARKER_OPTIONS={inclusiveLeft:!0,inclusiveRight:!0,className:TEXT_MARKER_CLASS_NAME},PREFIX_LIST=["webkit","moz","o"],capitalizeString=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},getPrefixedPropertyName=function(a){var b,c,d,e,f;if(d=document.createElement("div"),null!=d.style[a])return a;for(e=0,f=PREFIX_LIST.length;f>e;e++)if(b=PREFIX_LIST[e],c=b+capitalizeString(a),null!=d.style[c])return c;return!1},CodeMirror.defineOption("enableCompositionMod",!1,function(a,b){return b&&!modInitialized?null!=window.CompositionEvent?initCompositionMode(a):(console.warn("Your browser doesn't support CompositionEvent."),a.setOption("enableCompositionMod",!1)):void 0}),CodeMirror.defineOption("debugCompositionMod",!1,function(a,b){var d;return d=a.display.input,"undefined"!=typeof jQuery&&null!==jQuery?b?($(d).on("input.composition-debug keypress.composition-debug compositionupdate.composition-debug",function(a){return console.log("["+a.type+"]",a.originalEvent.data,d.value,a.timeStamp)}),$(d).on("compositionstart.composition-debug compositionend.composition-debug",function(b){return console.warn("["+b.type+"]",b.originalEvent.data,d.value,a.getCursor(),b.timeStamp)})):$(d).off(".composition-debug"):void 0}),setInputTranslate=function(a,b){var c;return c=getPrefixedPropertyName("transform"),a.display.input.style[c]=b},resetInputTranslate=function(){return setInputTranslate("")},clearCompositionTextMarkers=function(a){var b,c,d,e;for(c=a.getAllMarks(),d=0,e=c.length;e>d;d++)b=c[d],null!=b&&b.className===TEXT_MARKER_CLASS_NAME&&(b.clear(),a.options.debugCompositionMod&&console.log("[TextMarker] Cleared"));return!0},initCompositionMode=function(a){var b,c;return b=a.display.input,c=a.display.inputDiv,c.classList.add("CodeMirror-input-wrapper"),CodeMirror.on(b,"compositionstart",function(){return a.options.enableCompositionMod?(a.display.inCompositionMode=!0,a.setOption("readOnly",!0),a.somethingSelected()&&a.replaceSelection(""),a.display.compositionHead=a.getCursor(),a.options.debugCompositionMod&&console.log("[compositionstart] Update Composition Head",a.display.compositionHead),b.value="",a.options.debugCompositionMod&&console.log("[compositionstart] Clear cm.display.input",a.display.compositionHead),c.classList.add("in-composition")):void 0}),CodeMirror.on(b,"compositionupdate",function(b){var c,d,e,f;if(a.options.enableCompositionMod)return d=a.display.compositionHead,a.display.textMarkerInComposition?(e=a.display.textMarkerInComposition.find(),a.replaceRange(b.data,d,e.to),a.display.textMarkerInComposition.clear(),a.display.textMarkerInComposition=void 0):a.replaceRange(b.data,d,d),c=a.getCursor(),a.display.textMarkerInComposition=a.markText(d,c,TEXT_MARKER_OPTIONS),f=a.charCoords(c).left-a.charCoords(d).left,setInputTranslate(a,"translateX(-"+f+"px)")}),CodeMirror.on(b,"compositionend",function(d){var e,f,g,h,i;if(a.options.enableCompositionMod)return h=d.data,f=a.display.compositionHead,e=a.getCursor(),a.replaceRange(h,f,e),a.display.inCompositionMode=!1,a.display.compositionHead=void 0,null!=(i=a.display.textMarkerInComposition)&&i.clear(),a.display.textMarkerInComposition=void 0,a.setOption("readOnly",!1),c.classList.remove("in-composition"),clearCompositionTextMarkers(a),g=function(){return a.display.inCompositionMode?!1:(b.value="",a.options.debugCompositionMod&&console.warn("[postCompositionEnd] Input Cleared"),CodeMirror.off(b,"input",g),a.options.debugCompositionMod?console.log("[postCompositionEnd] Handler unregistered for future input events"):void 0)},CodeMirror.on(b,"input",g)})};
